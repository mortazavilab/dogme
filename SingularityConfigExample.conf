params {
    sample = 'C2C12_RNA_r1'
    //readType can either be 'RNA', 'DNA' or 'CDNA'
    readType = 'RNA'
    // change this value if 0.9 is too strict
    // if set to null or '' then modkit will determine its threshold by sampling reads. 
    modkitFilterThreshold = 0.9
    // modification type should be set as necessary if different from 'inosine_m6A,pseU,m5C' for RNA and '5mCG_5hmCG,6mA' for DNA. 
    modifications ='inosine_m6A_2OmeA,pseU_2OmeU,m5C_2OmeC,2OmeG'
    //change setting if necessary 
    minCov = 3
    perMod = 5
    // change if the launch directory is not where the pod5 and output directories should go
    topDir = "/dfs9/seyedam-lab/share/dogme-test/dRNA-minitest"

    scriptEnv = "${launchDir}/dogme.profile"

    // needs to be modified to match the right genomic reference
    //genomeRef = '/share/crsp/lab/seyedam/share/genomeRef/IGVFFI9282QLXO.fasta'      //'/share/crsp/lab/seyedam/share/bridge_dRNA/kallistoref/GRCm39.primary_assembly.genome.fa'
    //annotRef = '/share/crsp/lab/seyedam/share/genomeRef/IGVFFI4777RDZK.gtf'      //'/share/crsp/lab/seyedam/share/bridge_dRNA/kallistoref/gencode.vM36.annotation.gtf'
    
     genome_annot_refs = [
     [name: 'mm39', genome: '/share/crsp/lab/seyedam/share/genomeRef/IGVFFI9282QLXO.fasta', annot: '/share/crsp/lab/seyedam/share/genomeRef/IGVFFI4777RDZK.gtf'],
     [name: 'C57BL_6J_T2T_v1', genome: '/share/crsp/lab/seyedam/share/genomeRef/C57BL_6J_T2T_v1/unmasked.fa', annot: '/share/crsp/lab/seyedam/share/genomeRef/C57BL_6J_T2T_v1/genes.gtf'],
     [name: 'CAST_EiJ_T2T_v1', genome: '/share/crsp/lab/seyedam/share/genomeRef/CAST_EiJ_T2T_v1/unmasked.fa', annot: '/share/crsp/lab/seyedam/share/genomeRef/CAST_EiJ_T2T_v1/genes.gtf']
     ]
    
    kallistoIndex = '/share/crsp/lab/seyedam/share/bridge_dRNA/kallistoref/mm39GencM36_k63.idx'
    t2g = '/share/crsp/lab/seyedam/share/bridge_dRNA/kallistoref/mm39GencM36_k63.t2g'

    //default accuracy is sup
    accuracy = "sup"
    // change this value if 0.9 is too strict
    // if set to null or '' then modkit will determine its threshold by sampling reads. 
    modkitFilterThreshold = 0.9 


    // these paths are all based on the topDir and sample name
    // dogme will populate all of these folders with its output
    modDir = "${topDir}/dorModels"
    dorDir = "${topDir}/dor8-${sample}"
    podDir = "/share/crsp/lab/seyedam/share/c2c12_dRNA/c2c12_mb_dRNA_min_e1_1/pod5"
    bamDir = "${topDir}/bams"
    annotDir = "${topDir}/annot"
    bedDir = "${topDir}/bedMethyl"
    fastqDir = "${topDir}/fastqs"
    kallistoDir = "${topDir}/kallisto"
    tmpDir = '/tmp'  // Temporary directory for disk-based sorting
}

singularity {
    enabled = true
    autoMounts = true
}

process {
    // --- Container Settings ---
    container = 'ghcr.io/mortazavilab/dogme-pipeline:latest'
    containerOptions = "--bind /dfs9,/share/crsp/lab" // Make HPC storage visible to container
    beforeScript = 'export PATH=/opt/conda/bin:$PATH'

    // --- Slurm Executor ---
    executor = 'slurm'
    cpuPartition = 'standard'
    gpuPartition = 'gpu'
    cpuAccount = 'MODEL-AD_LAB'
    gpuAccount = 'SEYEDAM_LAB_GPU'

    // General default settings - adjust as necessary
    cpus = 12                     
    memory = '64 GB'              
    time = '8:00:00'          
    clusterOptions = "--account=${cpuAccount}"
    queue = "${cpuPartition}"

    withName: 'doradoTask' {
        clusterOptions = "--account=${gpuAccount} --gres=gpu:A100:1 --output=logs/doradoTask-%j.out --error=logs/doradoTask-%j.err"
        memory = '9 GB'  // Increase id necessary
        cpus = 4         // dorado is more GPU intensive than CPU intensive
        queue = "${gpuPartition}"
        containerOptions = "--nv --bind /dfs9,/share/crsp/lab" // Add --nv for GPU access
    }
    
    withName: 'minimapTask' {
        memory = '120 GB'  // Increase memory for minimap2
    }
}

timeline {
    enabled = true
    file = "${params.sample}_timeline.html"
}

report {
    enabled = true
    file = "${params.sample}_report.html"
}

trace {
    enabled = true
    file = "${params.sample}_trace.txt"
}
